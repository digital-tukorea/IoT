[{"id":"8172a1cd31381315","type":"mqtt in","z":"e5d3c42a520edfbf","name":"ë°”ì½”ë“œ ìˆ˜ì‹ ","topic":"smart_fridge/barcode_scanned","qos":"0","datatype":"auto-detect","broker":"f495b800278633f0","nl":false,"rap":true,"rh":0,"inputs":0,"x":200,"y":120,"wires":[["de323501856778e3"]]},{"id":"de323501856778e3","type":"function","z":"e5d3c42a520edfbf","name":"SQL ì¿¼ë¦¬ ìƒì„±","func":"// msg.payloadê°€ ë¬¸ìì—´ì´ë©´ JSON ë°ì´í„°ë§Œ ì¶”ì¶œ\nif (typeof msg.payload === \"string\") {\n    try {\n        // JSON ë¶€ë¶„ë§Œ ì¶”ì¶œ (ì •ê·œì‹ í™œìš©)\n        let jsonMatch = msg.payload.match(/\\{.*\\}/s);\n        if (jsonMatch) {\n            msg.payload = JSON.parse(jsonMatch[0]);\n        } else {\n            // JSON í˜•ì‹ì´ ì•„ë‹ˆë©´ ê·¸ëƒ¥ ë¡œê·¸ë§Œ ë‚¨ê¸°ê³  íŒ¨ìŠ¤\n            node.warn(\"âš ï¸ JSON ë°ì´í„° ê°ì§€ ì‹¤íŒ¨, ì›ë³¸ ë©”ì‹œì§€ ê·¸ëŒ€ë¡œ ìœ ì§€: \" + msg.payload);\n            return null;\n        }\n    } catch (e) {\n        // JSON ë³€í™˜ ì˜¤ë¥˜ê°€ ë°œìƒí•´ë„ ë©”ì‹œì§€ë¥¼ ë¬´ì‹œí•˜ì§€ ì•Šê³  ê³„ì† ì§„í–‰\n        node.warn(\"âš ï¸ JSON ë³€í™˜ ì˜¤ë¥˜ ë°œìƒ, ì›ë³¸ ë©”ì‹œì§€ ê·¸ëŒ€ë¡œ ìœ ì§€: \" + msg.payload);\n        return null;\n    }\n}\n\n// JSON ê°ì²´ì—ì„œ ë°”ì½”ë“œ ë°ì´í„° ì¶”ì¶œ\nif (msg.payload && msg.payload.barcode) {\n    msg.topic = \"UPDATE food_inventory SET quantity = quantity + 1 WHERE barcode = '\" + msg.payload.barcode + \"'\";\n    return msg;\n} else {\n    node.warn(\"âš ï¸ Invalid payload: \" + JSON.stringify(msg.payload));\n    return null;\n}\n\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":380,"y":120,"wires":[["e8c9e42a2aa32746"]]},{"id":"e8c9e42a2aa32746","type":"mysql","z":"e5d3c42a520edfbf","mydb":"951ad4ffb693d193","name":"DB ì—…ë°ì´íŠ¸","x":570,"y":120,"wires":[["7b8a75915a3ef59c"]]},{"id":"7b8a75915a3ef59c","type":"mqtt out","z":"e5d3c42a520edfbf","name":"ì—…ë°ì´íŠ¸ëœ ë°ì´í„° ì „ì†¡","topic":"smart_fridge/inventory_update","qos":"0","retain":"false","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"f495b800278633f0","x":780,"y":120,"wires":[]},{"id":"66922ba650524f1b","type":"inject","z":"e5d3c42a520edfbf","name":"ë°”ì½”ë“œ ìŠ¤ìº” ì‹¤í–‰","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":240,"y":60,"wires":[["5686417b0f64a507"]]},{"id":"5686417b0f64a507","type":"exec","z":"e5d3c42a520edfbf","command":"sudo /home/6team/smart_fridge_project/venv/bin/python3 /home/6team/smart_fridge_project/barcode_scanner.py","addpay":"","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"ë°”ì½”ë“œ ìŠ¤ìº”","x":430,"y":60,"wires":[["9ebc6e859712c426"],[],[]]},{"id":"9ebc6e859712c426","type":"mqtt out","z":"e5d3c42a520edfbf","name":"ë°”ì½”ë“œ ê²°ê³¼ ì „ì†¡","topic":"smart_fridge/barcode_scanned","qos":"0","retain":"false","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"f495b800278633f0","x":620,"y":60,"wires":[]},{"id":"a56cdee75c56716c","type":"inject","z":"e5d3c42a520edfbf","name":"íƒ€ì´ë¨¸","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":210,"y":180,"wires":[["6d6b413e5cea9c0e"]]},{"id":"6d6b413e5cea9c0e","type":"function","z":"e5d3c42a520edfbf","name":"Query DB","func":"msg.topic = \"SELECT barcode, name, expiry, quantity FROM food_inventory\";\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":360,"y":180,"wires":[["644b9d405ebc416a"]]},{"id":"644b9d405ebc416a","type":"mysql","z":"e5d3c42a520edfbf","mydb":"951ad4ffb693d193","name":"MariaDB ì—°ê²°","x":540,"y":180,"wires":[["6b106aad9addfbb2"]]},{"id":"6b106aad9addfbb2","type":"ui_table","z":"e5d3c42a520edfbf","group":"efefab69d4c78d84","name":"ë³´ìœ  í’ˆëª©","order":0,"width":"15","height":"20","columns":[],"outputs":0,"cts":false,"x":720,"y":180,"wires":[]},{"id":"4edf0b57a02b182e","type":"mysql","z":"e5d3c42a520edfbf","mydb":"951ad4ffb693d193","name":"ë³´ìœ  ì¤‘ì¸ ì¬ë£Œ ê°€ì ¸ì˜¤ê¸°","x":580,"y":240,"wires":[["4462b64945d4100a","d65206846973b2c9"]]},{"id":"9c09f9a65057111e","type":"inject","z":"e5d3c42a520edfbf","name":"MariaDB","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":220,"y":240,"wires":[["d394b40e1ed51427"]]},{"id":"d394b40e1ed51427","type":"function","z":"e5d3c42a520edfbf","name":"ì¿¼ë¦¬ ì…ë ¥","func":"msg.topic = \"SELECT name FROM food_inventory WHERE quantity > 0;\";\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":380,"y":240,"wires":[["4edf0b57a02b182e"]]},{"id":"ec0d9107c1396d02","type":"http request","z":"e5d3c42a520edfbf","name":"API ìš”ì²­","method":"GET","ret":"obj","paytoqs":"ignore","url":"https://api.spoonacular.com/recipes/findByIngredients?ingredients=apple,eggs,frozen dumplings,beverage,milk,cheese,bread,onion,carrot,potato,bacon,pasta,tomato sauce,butter,chicken breast,sausage,yogurt,quail egg,ham,kimchi,chicken nuggets,salmon,shrimp,squid,pork,beef,tofu,fish cake,chocolate,cream cheese,ice cream,tomato,broccoli,mushroom,ketchup,mayonnaise,mustard,doenjang,gochujang,ssamjang,frozen blueberries,whipping cream,stir-fried anchovies,lettuce,canned tuna,mackerel&apiKey=214312872ffd41379d29194c4139d2be","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":400,"y":300,"wires":[["350d7c568d1bf9bb"]]},{"id":"4462b64945d4100a","type":"function","z":"e5d3c42a520edfbf","name":"ì¬ë£Œ ë¦¬ìŠ¤íŠ¸ ë³€í™˜","func":"const API_KEY = \"214312872ffd41379d29194c4139d2be\";  // API Key\n\n// ì¬ë£Œ í•œêµ­ì–´ â†’ ì˜ì–´ ë³€í™˜ ë§¤í•‘\nconst ingredientMap = {\n    \"ì‚¬ê³¼\": \"apple\",\n\"ë‹¬ê±€\": \"eggs\",\n\"ëƒ‰ë™ë§Œë‘\": \"frozen dumplings\",\n\"ìŒë£Œìˆ˜\": \"beverage\",\n\"ìš°ìœ \": \"milk\",\n\"ì¹˜ì¦ˆ\": \"cheese\",\n\"ì‹ë¹µ\": \"bread\",\n\"ì–‘íŒŒ\": \"onion\",\n\"ë‹¹ê·¼\": \"carrot\",\n\"ê°ì\": \"potato\",\n\"ë² ì´ì»¨\": \"bacon\",\n\"íŒŒìŠ¤íƒ€ë©´\": \"pasta\",\n\"í† ë§ˆí† ì†ŒìŠ¤\": \"tomato sauce\",\n\"ë²„í„°\": \"butter\",\n\"ë‹­ê°€ìŠ´ì‚´\": \"chicken breast\",\n\"ì†Œì‹œì§€\": \"sausage\",\n\"ìš”ê±°íŠ¸\": \"yogurt\",\n\"ë©”ì¶”ë¦¬ì•Œ\": \"quail egg\",\n\"ìŠ¤íŒ¸\": \"ham\",\n\"ê¹€ì¹˜\": \"kimchi\",\n\"ì¹˜í‚¨ë„ˆê²Ÿ\": \"chicken nuggets\",\n\"ì—°ì–´\": \"salmon\",\n\"ìƒˆìš°\": \"shrimp\",\n\"ì˜¤ì§•ì–´\": \"squid\",\n\"ë¼ì§€ê³ ê¸°\": \"pork\",\n\"ì†Œê³ ê¸°\": \"beef\",\n\"ë‘ë¶€\": \"tofu\",\n\"ì–´ë¬µ\": \"fish cake\",\n\"ì´ˆì½œë¦¿\": \"chocolate\",\n\"í¬ë¦¼ì¹˜ì¦ˆ\": \"cream cheese\",\n\"ì•„ì´ìŠ¤í¬ë¦¼\": \"ice cream\",\n\"í† ë§ˆí† \": \"tomato\",\n\"ë¸Œë¡œì½œë¦¬\": \"broccoli\",\n\"ë²„ì„¯\": \"mushroom\",\n\"ì¼€ì²©\": \"ketchup\",\n\"ë§ˆìš”ë„¤ì¦ˆ\": \"mayonnaise\",\n\"ë¨¸ìŠ¤íƒ€ë“œ\": \"mustard\",\n\"ëœì¥\": \"doenjang\",\n\"ê³ ì¶”ì¥\": \"gochujang\",\n\"ìŒˆì¥\": \"ssamjang\",\n\"ëƒ‰ë™ë¸”ë£¨ë² ë¦¬\": \"frozen blueberries\",\n\"ìƒí¬ë¦¼\": \"whipping cream\",\n\"ë©¸ì¹˜ë³¶ìŒ\": \"stir-fried anchovies\",\n\"ìƒì¶”\": \"lettuce\",\n\"ì°¸ì¹˜ìº”\": \"canned tuna\",\n\"ê³ ë“±ì–´\": \"mackerel\"\n};\n\n\n// MariaDBì—ì„œ ê°€ì ¸ì˜¨ ë°ì´í„° í™•ì¸\nlet data = msg.payload;\n\n// ë””ë²„ê¹…ìš© ë¡œê·¸ ì¶œë ¥\nconsole.log(\"DBì—ì„œ ê°€ì ¸ì˜¨ ë°ì´í„° êµ¬ì¡° í™•ì¸:\", data);\n\n// ë°°ì—´ì´ ì•„ë‹ˆê±°ë‚˜ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì˜¤ë¥˜ ë°˜í™˜\nif (!Array.isArray(data) || data.length === 0) {\n    node.error(\"âŒ í˜„ì¬ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì¬ë£Œê°€ ì—†ìŠµë‹ˆë‹¤.\", msg);\n    return null;\n}\n\n// ê°ì²´ ë°°ì—´ì„ ë¬¸ìì—´ ë°°ì—´ë¡œ ë³€í™˜\nlet translatedIngredients = data\n    .map(item => {\n        console.log(\"ë³€í™˜ ì „:\", item);  // ğŸ” item êµ¬ì¡° í™•ì¸\n        return ingredientMap[item.name] || item.name; // âœ… item.name ì‚¬ìš©\n    })\n    .join(\",\");\n\nconsole.log(\"ë³€í™˜ëœ ì¬ë£Œ ëª©ë¡:\", translatedIngredients); // âœ… ë³€í™˜ëœ ë°ì´í„° í™•ì¸\n\n// API ìš”ì²­ì„ ìœ„í•œ URL ì„¤ì •\nmsg.url = `https://api.spoonacular.com/recipes/findByIngredients?ingredients=${translatedIngredients}&apiKey=${API_KEY}`;\nmsg.method = \"GET\";  // HTTP GET ìš”ì²­\n\nreturn msg;\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":220,"y":300,"wires":[["ec0d9107c1396d02"]]},{"id":"c2c6976395048d89","type":"ui_table","z":"e5d3c42a520edfbf","group":"00b061539cbb090f","name":"ëƒ‰ì¥ê³  ë ˆì‹œí”¼","order":1,"width":24,"height":12,"columns":[{"field":"title","title":"ìš”ë¦¬ ì´ë¦„","width":"50px","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"usedIngredients","title":"ëƒ‰ì¥ê³ ì— ìˆëŠ” ì¬ë£Œ","width":"75px","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"missedIngredients","title":"ëƒ‰ì¥ê³ ì— ì—†ëŠ” ì¬ë£Œ","width":"50px","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}}],"outputs":0,"cts":false,"x":830,"y":300,"wires":[]},{"id":"1dd8c6ac5b9fb4c2","type":"http in","z":"e5d3c42a520edfbf","name":"ë³´ìœ  í’ˆëª© ì¡°íšŒ","url":"/inventory","method":"get","upload":false,"swaggerDoc":"","x":210,"y":420,"wires":[["489ba96e99813afb"]]},{"id":"489ba96e99813afb","type":"function","z":"e5d3c42a520edfbf","name":"function 1","func":"msg.topic = \"SELECT barcode, name, expiry, quantity FROM food_inventory WHERE quantity > 0\";\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":380,"y":420,"wires":[["e625449a609e349d"]]},{"id":"e625449a609e349d","type":"mysql","z":"e5d3c42a520edfbf","mydb":"951ad4ffb693d193","name":"MariaDB ì—°ê²°","x":560,"y":420,"wires":[["2742c218889e56cf"]]},{"id":"2742c218889e56cf","type":"function","z":"e5d3c42a520edfbf","name":"function 2","func":"// MariaDBì—ì„œ ê°€ì ¸ì˜¨ ë°ì´í„°ê°€ ë°°ì—´ì¸ì§€ í™•ì¸\nif (!Array.isArray(msg.payload)) {\n    node.error(\"ğŸš¨ ë°ì´í„°ê°€ ë°°ì—´ì´ ì•„ë‹™ë‹ˆë‹¤.\");\n    msg.payload = [];\n}\n\n// JSON í˜•ì‹ìœ¼ë¡œ ë³€í™˜\nmsg.payload = JSON.stringify(msg.payload);\nreturn msg;\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":740,"y":420,"wires":[["f030389ea4c469ed"]]},{"id":"f030389ea4c469ed","type":"http response","z":"e5d3c42a520edfbf","name":"","statusCode":"","headers":{},"x":890,"y":420,"wires":[]},{"id":"d65206846973b2c9","type":"debug","z":"e5d3c42a520edfbf","name":"debug 1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":820,"y":240,"wires":[]},{"id":"6cce2db3feeabdfe","type":"inject","z":"e5d3c42a520edfbf","name":"ë¶€ì¡±í•œ ì¬ë£Œ í™•ì¸ (30ì´ˆë§ˆë‹¤ ì‹¤í–‰)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"30","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":280,"y":660,"wires":[["40b30f9a516de4b4"]]},{"id":"40b30f9a516de4b4","type":"function","z":"e5d3c42a520edfbf","name":"SQL: ë¶€ì¡±í•œ ì¬ë£Œ ì¡°íšŒ","func":"msg.topic = \"SELECT barcode, name, quantity FROM food_inventory WHERE quantity <= 2;\";\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":560,"y":660,"wires":[["c65870a3bfa90551"]]},{"id":"c65870a3bfa90551","type":"mysql","z":"e5d3c42a520edfbf","mydb":"951ad4ffb693d193","name":"MariaDB (ë¶€ì¡±í•œ ì¬ë£Œ ì¡°íšŒ)","x":820,"y":660,"wires":[["e977f5a257e792f0"]]},{"id":"e977f5a257e792f0","type":"function","z":"e5d3c42a520edfbf","name":"ë¶€ì¡±í•œ ì¬ë£Œê°€ ìˆìœ¼ë©´ MQTT ë°œí–‰","func":"if (msg.payload.length > 0) {\n    msg.topic = \"smart_fridge/low_stock_alert\";\n    msg.payload = JSON.stringify(msg.payload);\n    return msg;\n} else {\n    return null;  // ë¶€ì¡±í•œ ì¬ë£Œ ì—†ìœ¼ë©´ ì „ì†¡ ì•ˆ í•¨\n}","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":270,"y":720,"wires":[["b0775e2f58a008a4"]]},{"id":"b0775e2f58a008a4","type":"mqtt out","z":"e5d3c42a520edfbf","name":"MQTT: ë¶€ì¡±í•œ ì¬ë£Œ ì•Œë¦¼","topic":"smart_fridge/low_stock_alert","qos":"0","retain":"false","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"f495b800278633f0","x":550,"y":720,"wires":[]},{"id":"6212717eaf98c083","type":"http in","z":"e5d3c42a520edfbf","name":"ì…ì¶œê³  ì—…ë°ì´íŠ¸","url":"/update_inventory","method":"post","upload":false,"swaggerDoc":"","x":220,"y":780,"wires":[["c688a5585db66d47"]]},{"id":"c688a5585db66d47","type":"json","z":"e5d3c42a520edfbf","name":"JSON ë³€í™˜","property":"payload","action":"obj","pretty":false,"x":410,"y":780,"wires":[["9fdf3f2455c64ad8"]]},{"id":"9fdf3f2455c64ad8","type":"function","z":"e5d3c42a520edfbf","name":"ì…ì¶œê³  SQL ì¿¼ë¦¬ ìƒì„±","func":"try {\n    let payload = (typeof msg.payload === \"string\") ? JSON.parse(msg.payload) : msg.payload;\n\n    if (!payload.barcode || payload.quantity === undefined) {\n        node.warn(\"ğŸš¨ ì˜ëª»ëœ ìš”ì²­ ë°ì´í„°! payload: \" + JSON.stringify(payload));\n        return null;\n    }\n\n    let barcode = payload.barcode;\n    let quantity = parseInt(payload.quantity, 10); // ì •ìˆ˜ ë³€í™˜\n\n    if (isNaN(quantity)) {\n        node.warn(\"ğŸš¨ ìœ íš¨í•˜ì§€ ì•Šì€ ìˆ˜ëŸ‰ ê°’: \" + payload.quantity);\n        return null;\n    }\n\n    if (quantity > 0) {\n        // âœ… ì…ê³  (ìˆ˜ëŸ‰ ì¶”ê°€)\n        msg.topic = `UPDATE food_inventory SET quantity = quantity + ${quantity} WHERE barcode = '${barcode}';`;\n    } else {\n        // âœ… ì¶œê³  (ì°¨ê°, 0 ì´í•˜ ë°©ì§€)\n        quantity = Math.abs(quantity);\n        msg.topic = `UPDATE food_inventory SET quantity = GREATEST(quantity - ${quantity}, 0) WHERE barcode = '${barcode}';`;\n    }\n\n    msg.barcode = barcode;\n    return msg;\n} catch (e) {\n    node.error(\"ğŸš¨ JSON ë³€í™˜ ì˜¤ë¥˜ ë°œìƒ: \" + e.message);\n    return null;\n}","outputs":1,"timeout":"","noerr":0,"initialize":"","finalize":"","libs":[],"x":620,"y":780,"wires":[["4488bee74991ded4"]]},{"id":"4488bee74991ded4","type":"mysql","z":"e5d3c42a520edfbf","mydb":"0ce275075db5db19","name":"DB ì—…ë°ì´íŠ¸","x":830,"y":780,"wires":[["05ac5dd77b13ed28"]]},{"id":"05ac5dd77b13ed28","type":"function","z":"e5d3c42a520edfbf","name":"ì—…ë°ì´íŠ¸ëœ ì¬ê³  ì¡°íšŒ","func":"msg.topic = `SELECT barcode, name, quantity FROM food_inventory WHERE barcode = '${msg.barcode}';`;\nreturn msg;","outputs":1,"timeout":"","noerr":0,"initialize":"","finalize":"","libs":[],"x":240,"y":840,"wires":[["d7dada600d599ca6"]]},{"id":"d7dada600d599ca6","type":"mysql","z":"e5d3c42a520edfbf","mydb":"0ce275075db5db19","name":"ì¬ê³  ì •ë³´ ê°€ì ¸ì˜¤ê¸°","x":470,"y":840,"wires":[["a41780d724acd7e1","1a2c10e621d1459e"]]},{"id":"a41780d724acd7e1","type":"function","z":"e5d3c42a520edfbf","name":"MQTT ë©”ì‹œì§€ ìƒì„±","func":"if (msg.payload.length > 0) {\n    msg.topic = \"smart_fridge/inventory_update\";\n    msg.payload = JSON.stringify(msg.payload[0]);\n    return msg;\n} else {\n    return null;\n}","outputs":1,"timeout":"","noerr":0,"initialize":"","finalize":"","libs":[],"x":690,"y":840,"wires":[["57a6722936d8f2a6"]]},{"id":"57a6722936d8f2a6","type":"mqtt out","z":"e5d3c42a520edfbf","name":"MQTT: ì¬ê³  ì—…ë°ì´íŠ¸ ì „ì†¡","topic":"smart_fridge/inventory_update","qos":"0","retain":"false","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"dda57cdb5d701b51","x":930,"y":840,"wires":[]},{"id":"1a2c10e621d1459e","type":"http response","z":"e5d3c42a520edfbf","name":"ì…ì¶œê³  ê²°ê³¼ ì‘ë‹µ","statusCode":"200","headers":{},"x":680,"y":900,"wires":[]},{"id":"350d7c568d1bf9bb","type":"function","z":"e5d3c42a520edfbf","name":"API ì‘ë‹µ ë°ì´í„° ë³€í™˜","func":"if (!Array.isArray(msg.payload)) {\n    node.error(\"ğŸš¨ msg.payloadê°€ ë°°ì—´ì´ ì•„ë‹™ë‹ˆë‹¤. ë¹ˆ ë°°ì—´ë¡œ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.\");\n    msg.payload = [];\n}\n\n// ë°°ì—´ ë‚´ ê° ë ˆì‹œí”¼ ê°ì²´ë¥¼ ë³€í™˜\nmsg.payload = msg.payload.map(recipe => ({\n    id: recipe.id,\n    title: recipe.title,\n    usedIngredients: recipe.usedIngredients.map(ing => ing.name).join(\", \"),  \n    missedIngredients: recipe.missedIngredients.map(ing => ing.name).join(\", \"),\n    instructions: recipe.instructions || \"ì¡°ë¦¬ë²• ì •ë³´ ì—†ìŒ\" // âœ… ì¡°ë¦¬ë²• ì¶”ê°€\n}));\n\nreturn msg;\n\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":600,"y":300,"wires":[["c2c6976395048d89","d65206846973b2c9"]]},{"id":"ad25adb25d9f257e","type":"json","z":"e5d3c42a520edfbf","name":"JSON ë³€í™˜","property":"payload","action":"obj","pretty":false,"x":230,"y":1120,"wires":[["3798a4955472a83b"]]},{"id":"129170487413433b","type":"mysql","z":"e5d3c42a520edfbf","mydb":"951ad4ffb693d193","name":"ë³´ìœ  ì¤‘ì¸ ì¬ë£Œ ê°€ì ¸ì˜¤ê¸°","x":580,"y":1000,"wires":[["3d482efb12d09283"]]},{"id":"8ad8d603e2813daf","type":"inject","z":"e5d3c42a520edfbf","name":"MariaDB","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":220,"y":1000,"wires":[["7dd7b456793694df"]]},{"id":"7dd7b456793694df","type":"function","z":"e5d3c42a520edfbf","name":"ì¿¼ë¦¬ ì…ë ¥","func":"msg.topic = \"SELECT name FROM food_inventory WHERE quantity > 0;\";\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":380,"y":1000,"wires":[["129170487413433b"]]},{"id":"5e5aca69e6edd9f8","type":"http request","z":"e5d3c42a520edfbf","name":"API ìš”ì²­","method":"GET","ret":"obj","paytoqs":"ignore","url":"https://api.spoonacular.com/recipes/findByIngredients?ingredients=apple,eggs,frozen dumplings,beverage,milk,cheese,bread,onion,carrot,potato,bacon,pasta,tomato sauce,butter,chicken breast,sausage,yogurt,quail egg,ham,kimchi,chicken nuggets&apiKey=214312872ffd41379d29194c4139d2be","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":420,"y":1060,"wires":[["19530f40c51da2b9"]]},{"id":"3d482efb12d09283","type":"function","z":"e5d3c42a520edfbf","name":"ì¬ë£Œ ë¦¬ìŠ¤íŠ¸ ë³€í™˜","func":"const API_KEY = \"d6c62460b4eb4e439182c0f8bb133703\";  // API Key\n\n// ì¬ë£Œ í•œêµ­ì–´ â†’ ì˜ì–´ ë³€í™˜ ë§¤í•‘\nconst ingredientMap = {\n    \"ì‚¬ê³¼\": \"apple\",\n    \"ë‹¬ê±€\": \"eggs\",\n    \"ëƒ‰ë™ë§Œë‘\": \"frozen dumplings\",\n    \"ìŒë£Œìˆ˜\": \"beverage\",\n    \"ìš°ìœ \": \"milk\",\n    \"ì¹˜ì¦ˆ\": \"cheese\",\n    \"ì‹ë¹µ\": \"bread\",\n    \"ì–‘íŒŒ\": \"onion\",\n    \"ë‹¹ê·¼\": \"carrot\",\n    \"ê°ì\": \"potato\",\n    \"ë² ì´ì»¨\": \"bacon\",\n    \"íŒŒìŠ¤íƒ€ë©´\": \"pasta\",\n    \"í† ë§ˆí† ì†ŒìŠ¤\": \"tomato sauce\",\n    \"ë²„í„°\": \"butter\",\n    \"ë‹­ê°€ìŠ´ì‚´\": \"chicken breast\",\n    \"ì†Œì‹œì§€\": \"sausage\",\n    \"ìš”ê±°íŠ¸\": \"yogurt\",\n    \"ë©”ì¶”ë¦¬ì•Œ\": \"quail egg\",\n    \"ìŠ¤íŒ¸\": \"ham\",\n    \"ê¹€ì¹˜\": \"kimchi\",\n    \"ì¹˜í‚¨ë„ˆê²Ÿ\": \"chicken nuggets\"\n};\n\n\n// MariaDBì—ì„œ ê°€ì ¸ì˜¨ ë°ì´í„° í™•ì¸\nlet data = msg.payload;\n\n// ë””ë²„ê¹…ìš© ë¡œê·¸ ì¶œë ¥\nconsole.log(\"DBì—ì„œ ê°€ì ¸ì˜¨ ë°ì´í„° êµ¬ì¡° í™•ì¸:\", data);\n\n// ë°°ì—´ì´ ì•„ë‹ˆê±°ë‚˜ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì˜¤ë¥˜ ë°˜í™˜\nif (!Array.isArray(data) || data.length === 0) {\n    node.error(\"âŒ í˜„ì¬ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì¬ë£Œê°€ ì—†ìŠµë‹ˆë‹¤.\", msg);\n    return null;\n}\n\n// ê°ì²´ ë°°ì—´ì„ ë¬¸ìì—´ ë°°ì—´ë¡œ ë³€í™˜\nlet translatedIngredients = data\n    .map(item => {\n        console.log(\"ë³€í™˜ ì „:\", item);  // ğŸ” item êµ¬ì¡° í™•ì¸\n        return ingredientMap[item.name] || item.name; // âœ… item.name ì‚¬ìš©\n    })\n    .join(\",\");\n\nconsole.log(\"ë³€í™˜ëœ ì¬ë£Œ ëª©ë¡:\", translatedIngredients); // âœ… ë³€í™˜ëœ ë°ì´í„° í™•ì¸\n\n// API ìš”ì²­ì„ ìœ„í•œ URL ì„¤ì •\nmsg.url = `https://api.spoonacular.com/recipes/findByIngredients?ingredients=${translatedIngredients}&apiKey=${API_KEY}`;\nmsg.method = \"GET\";  // HTTP GET ìš”ì²­\n\nreturn msg;\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":240,"y":1060,"wires":[["5e5aca69e6edd9f8"]]},{"id":"19530f40c51da2b9","type":"function","z":"e5d3c42a520edfbf","name":"API ì‘ë‹µ ë°ì´í„° ë³€í™˜","func":"if (!Array.isArray(msg.payload)) {\n    node.error(\"ğŸš¨ msg.payloadê°€ ë°°ì—´ì´ ì•„ë‹™ë‹ˆë‹¤. ë¹ˆ ë°°ì—´ë¡œ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.\");\n    msg.payload = [];\n}\n\n// ë ˆì‹œí”¼ ëª©ë¡ì„ ë“œë¡­ë‹¤ìš´ì— ë§ê²Œ ë³€í™˜\nlet recipes = msg.payload.map(recipe => ({\n    label: recipe.title,  // âœ… ë“œë¡­ë‹¤ìš´ì—ì„œ í‘œì‹œë  ë ˆì‹œí”¼ ì´ë¦„\n    value: JSON.stringify({  // âœ… ì„ íƒ ì‹œ í•´ë‹¹ ë ˆì‹œí”¼ì˜ ë°ì´í„° ì „ë‹¬\n        usedIngredients: Array.isArray(recipe.usedIngredients) \n            ? recipe.usedIngredients.map(ing => ing.name.trim()).join(\", \") \n            : \"ì‚¬ìš©í•œ ì¬ë£Œ ì—†ìŒ\",\n        missedIngredients: Array.isArray(recipe.missedIngredients) \n            ? recipe.missedIngredients.map(ing => ing.name.trim()).join(\", \") \n            : \"ë¶€ì¡±í•œ ì¬ë£Œ ì—†ìŒ\"\n    })\n}));\n\nmsg.options = recipes;  // âœ… ë“œë¡­ë‹¤ìš´ ë…¸ë“œì— ë„˜ê¸¸ ë°ì´í„°\nreturn msg;\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":620,"y":1060,"wires":[["ad25adb25d9f257e"]]},{"id":"4735ceec6a759be7","type":"change","z":"e5d3c42a520edfbf","name":"","rules":[{"t":"set","p":"options","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":1120,"wires":[["3ce67485c0244d3a","4e6d54114708366c"]]},{"id":"3ce67485c0244d3a","type":"ui_dropdown","z":"e5d3c42a520edfbf","name":"ë ˆì‹œí”¼ ì„ íƒ","label":"ë ˆì‹œí”¼ ì„ íƒ","tooltip":"ì¶”ì²œëœ ë ˆì‹œí”¼ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•˜ì„¸ìš”.","place":"ë ˆì‹œí”¼ë¥¼ ì„ íƒí•˜ì„¸ìš”","group":"298b80289dee126f","order":1,"width":0,"height":0,"passthru":true,"multiple":false,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"msg.selected_recipe","topicType":"msg","className":"","x":810,"y":1120,"wires":[["cc8b433b595d4f46","4e6d54114708366c"]]},{"id":"3798a4955472a83b","type":"function","z":"e5d3c42a520edfbf","name":"ë ˆì‹œí”¼ ëª©ë¡ ë³€í™˜","func":"// ë ˆì‹œí”¼ ë°ì´í„°ë¥¼ msg.payloadì—ì„œ ê°€ì ¸ì˜´\nlet recipes = msg.payload;\n\nif (Array.isArray(recipes)) {\n    msg.options = recipes.map(recipe => ({\n        label: recipe.title,   // ì—¬ê¸°ì„œ titleì´ labelë¡œ ë“¤ì–´ê°€ì•¼ í•¨\n        value: recipe.title    // valueë„ titleë¡œ ì„¤ì • (í˜¹ì€ idë¡œ ì„¤ì • ê°€ëŠ¥)\n    }));\n} else {\n    msg.options = [];\n}\n\nreturn msg;\n","outputs":1,"timeout":"","noerr":0,"initialize":"","finalize":"","libs":[],"x":420,"y":1120,"wires":[["4735ceec6a759be7"]]},{"id":"4e6d54114708366c","type":"debug","z":"e5d3c42a520edfbf","name":"debug 5","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":800,"y":1200,"wires":[]},{"id":"cc8b433b595d4f46","type":"ui_table","z":"e5d3c42a520edfbf","group":"47ff348e4144909d","name":"","order":1,"width":"29","height":"26","columns":[],"outputs":0,"cts":false,"x":970,"y":1120,"wires":[]},{"id":"7b6a14fe21bca2d7","type":"http in","z":"e5d3c42a520edfbf","name":"ë ˆì‹œí”¼ ì¡°íšŒ ìš”ì²­","url":"/get_recipes","method":"get","upload":false,"swaggerDoc":"","x":220,"y":480,"wires":[["320ec36ead5b5bad"]]},{"id":"320ec36ead5b5bad","type":"function","z":"e5d3c42a520edfbf","name":"ì‚¬ìš© ê°€ëŠ¥í•œ ì¬ë£Œ ì¡°íšŒ","func":"msg.topic = \"SELECT name FROM food_inventory WHERE quantity > 0;\";\nreturn msg;","outputs":1,"timeout":"","noerr":0,"initialize":"","finalize":"","libs":[],"x":440,"y":480,"wires":[["7873068322b60fbe"]]},{"id":"7873068322b60fbe","type":"mysql","z":"e5d3c42a520edfbf","mydb":"951ad4ffb693d193","name":"DB ì—°ê²°","x":640,"y":480,"wires":[["905677e7f293febd"]]},{"id":"905677e7f293febd","type":"function","z":"e5d3c42a520edfbf","name":"ì¬ë£Œ ë³€í™˜ (API ìš”ì²­ ì¤€ë¹„)","func":"var API_KEY = \"214312872ffd41379d29194c4139d2be\";\nvar inventory = msg.payload.map(item => item.name).join(\",\");\nmsg.url = `https://api.spoonacular.com/recipes/findByIngredients?ingredients=${inventory}&apiKey=${API_KEY}`;\nmsg.method = \"GET\";\nreturn msg;","outputs":1,"timeout":"","noerr":0,"initialize":"","finalize":"","libs":[],"x":850,"y":480,"wires":[["d5bab9106443587a"]]},{"id":"fdde0d1333f77e4b","type":"function","z":"e5d3c42a520edfbf","name":"ë ˆì‹œí”¼ ë°ì´í„° í•„í„°ë§ ë° ì¬ë£Œ ë§¤í•‘","func":"const ingredientMap = {\n   \"ì‚¬ê³¼\": \"apple\",\n\"ë‹¬ê±€\": \"eggs\",\n\"ëƒ‰ë™ë§Œë‘\": \"frozen dumplings\",\n\"ìŒë£Œìˆ˜\": \"beverage\",\n\"ìš°ìœ \": \"milk\",\n\"ì¹˜ì¦ˆ\": \"cheese\",\n\"ì‹ë¹µ\": \"bread\",\n\"ì–‘íŒŒ\": \"onion\",\n\"ë‹¹ê·¼\": \"carrot\",\n\"ê°ì\": \"potato\",\n\"ë² ì´ì»¨\": \"bacon\",\n\"íŒŒìŠ¤íƒ€ë©´\": \"pasta\",\n\"í† ë§ˆí† ì†ŒìŠ¤\": \"tomato sauce\",\n\"ë²„í„°\": \"butter\",\n\"ë‹­ê°€ìŠ´ì‚´\": \"chicken breast\",\n\"ì†Œì‹œì§€\": \"sausage\",\n\"ìš”ê±°íŠ¸\": \"yogurt\",\n\"ë©”ì¶”ë¦¬ì•Œ\": \"quail egg\",\n\"ìŠ¤íŒ¸\": \"ham\",\n\"ê¹€ì¹˜\": \"kimchi\",\n\"ì¹˜í‚¨ë„ˆê²Ÿ\": \"chicken nuggets\",\n\"ì—°ì–´\": \"salmon\",\n\"ìƒˆìš°\": \"shrimp\",\n\"ì˜¤ì§•ì–´\": \"squid\",\n\"ë¼ì§€ê³ ê¸°\": \"pork\",\n\"ì†Œê³ ê¸°\": \"beef\",\n\"ë‘ë¶€\": \"tofu\",\n\"ì–´ë¬µ\": \"fish cake\",\n\"ì´ˆì½œë¦¿\": \"chocolate\",\n\"í¬ë¦¼ì¹˜ì¦ˆ\": \"cream cheese\",\n\"ì•„ì´ìŠ¤í¬ë¦¼\": \"ice cream\",\n\"í† ë§ˆí† \": \"tomato\",\n\"ë¸Œë¡œì½œë¦¬\": \"broccoli\",\n\"ë²„ì„¯\": \"mushroom\",\n\"ì¼€ì²©\": \"ketchup\",\n\"ë§ˆìš”ë„¤ì¦ˆ\": \"mayonnaise\",\n\"ë¨¸ìŠ¤íƒ€ë“œ\": \"mustard\",\n\"ëœì¥\": \"doenjang\",\n\"ê³ ì¶”ì¥\": \"gochujang\",\n\"ìŒˆì¥\": \"ssamjang\",\n\"ëƒ‰ë™ë¸”ë£¨ë² ë¦¬\": \"frozen blueberries\",\n\"ìƒí¬ë¦¼\": \"whipping cream\",\n\"ë©¸ì¹˜ë³¶ìŒ\": \"stir-fried anchovies\",\n\"ìƒì¶”\": \"lettuce\",\n\"ì°¸ì¹˜ìº”\": \"canned tuna\",\n\"ê³ ë“±ì–´\": \"mackerel\"\n};\n\nmsg.payload = msg.payload.map(recipe => {\n    return {\n        \"title\": recipe.title,\n        \"usedIngredients\": recipe.usedIngredients.map(ing => ingredientMap[ing.name] || ing.name).join(\", \"),\n        \"missedIngredients\": recipe.missedIngredients.map(ing => ingredientMap[ing.name] || ing.name).join(\", \")\n    };\n});\n\nreturn msg;","outputs":1,"timeout":"","noerr":0,"initialize":"","finalize":"","libs":[],"x":510,"y":540,"wires":[["d9dfa81870672753"]]},{"id":"d5bab9106443587a","type":"http request","z":"e5d3c42a520edfbf","name":"Spoonacular API í˜¸ì¶œ","method":"GET","ret":"obj","paytoqs":"ignore","url":"https://api.spoonacular.com/recipes/findByIngredients?ingredients=apple,eggs,frozen dumplings,beverage,milk,cheese,bread,onion,carrot,potato,bacon,pasta,tomato sauce,butter,chicken breast,sausage,yogurt,quail egg,ham,kimchi,chicken nuggets,salmon,shrimp,squid,pork,beef,tofu,fish cake,chocolate,cream cheese,ice cream,tomato,broccoli,mushroom,ketchup,mayonnaise,mustard,doenjang,gochujang,ssamjang,frozen blueberries,whipping cream,stir-fried anchovies,lettuce,canned tuna,mackerel&apiKey=214312872ffd41379d29194c4139d2be","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":240,"y":540,"wires":[["fdde0d1333f77e4b"]]},{"id":"8210b91008cf9c40","type":"http in","z":"e5d3c42a520edfbf","name":"ë ˆì‹œí”¼ ì¡°ë¦¬ë²• ìš”ì²­","url":"/getRecipeInstructions","method":"get","upload":false,"swaggerDoc":"","x":230,"y":600,"wires":[["5c688b54b3016a98"]]},{"id":"5c688b54b3016a98","type":"function","z":"e5d3c42a520edfbf","name":"API URL ìƒì„±","func":"var recipeId = msg.payload.recipeId;\nvar apiKey = \"214312872ffd41379d29194c4139d2be\";\nvar url = `https://api.spoonacular.com/recipes/${recipeId}/analyzedInstructions?apiKey=${apiKey}`;\nmsg.url = url;\nreturn msg;","outputs":1,"x":430,"y":600,"wires":[["67b8c69276e42ef3"]]},{"id":"67b8c69276e42ef3","type":"http request","z":"e5d3c42a520edfbf","name":"Spoonacular API í˜¸ì¶œ","method":"GET","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":640,"y":600,"wires":[["3958eec02824325e"]]},{"id":"3958eec02824325e","type":"function","z":"e5d3c42a520edfbf","name":"ì¡°ë¦¬ë²• ì¶”ì¶œ","func":"var instructions = [];\nif (msg.payload.length > 0 && msg.payload[0].steps) {\n    msg.payload[0].steps.forEach(step => {\n        instructions.push(`${step.number}. ${step.step}`);\n    });\n}\nmsg.payload = { instructions: instructions };\nreturn msg;","outputs":1,"timeout":"","noerr":0,"initialize":"","finalize":"","libs":[],"x":850,"y":600,"wires":[["ff72d8aeb0f1502e"]]},{"id":"ff72d8aeb0f1502e","type":"http response","z":"e5d3c42a520edfbf","name":"ì¡°ë¦¬ë²• ì‘ë‹µ ì „ì†¡","statusCode":"200","headers":{},"x":1040,"y":600,"wires":[]},{"id":"d9dfa81870672753","type":"http response","z":"e5d3c42a520edfbf","name":"HTTP ì‘ë‹µ (ë ˆì‹œí”¼ ë°ì´í„° ë°˜í™˜)","statusCode":"200","headers":{},"x":810,"y":540,"wires":[]},{"id":"f495b800278633f0","type":"mqtt-broker","name":"","broker":"localhost","port":1883,"clientid":"","autoConnect":true,"usetls":false,"protocolVersion":"5","keepalive":60,"cleansession":true,"autoUnsubscribe":true,"birthTopic":"","birthQos":"0","birthRetain":"false","birthPayload":"","birthMsg":{},"closeTopic":"","closeQos":"0","closeRetain":"false","closePayload":"","closeMsg":{},"willTopic":"","willQos":"0","willRetain":"false","willPayload":"","willMsg":{},"userProps":"","sessionExpiry":""},{"id":"951ad4ffb693d193","type":"MySQLdatabase","name":"","host":"localhost","port":"3306","db":"smart_fridge","tz":"","charset":"UTF8"},{"id":"efefab69d4c78d84","type":"ui_group","name":"ëƒ‰ì¥ê³ ","tab":"f8b0a2bfa39ad195","order":1,"disp":true,"width":"15","collapse":false,"className":""},{"id":"00b061539cbb090f","type":"ui_group","name":"food","tab":"e153cafbb86014ea","order":1,"disp":true,"width":"27","collapse":false,"className":""},{"id":"0ce275075db5db19","type":"MySQLdatabase","name":"","host":"localhost","port":"3306","db":"smart_fridge","tz":"","charset":"UTF8"},{"id":"dda57cdb5d701b51","type":"mqtt-broker","name":"","broker":"localhost","port":1883,"clientid":"","autoConnect":true,"usetls":false,"protocolVersion":"5","keepalive":60,"cleansession":true,"autoUnsubscribe":true,"birthTopic":"","birthQos":"0","birthRetain":"false","birthPayload":"","birthMsg":{},"closeTopic":"","closeQos":"0","closeRetain":"false","closePayload":"","closeMsg":{},"willTopic":"","willQos":"0","willRetain":"false","willPayload":"","willMsg":{},"userProps":"","sessionExpiry":""},{"id":"298b80289dee126f","type":"ui_group","name":"Default","tab":"960301b41003c880","order":1,"disp":true,"width":"13","collapse":false,"className":""},{"id":"47ff348e4144909d","type":"ui_group","name":"ëƒ‰ì¥ê³ ","tab":"f78034d6b60b791a","order":1,"disp":true,"width":"42","collapse":false,"className":""},{"id":"f8b0a2bfa39ad195","type":"ui_tab","name":"Home","icon":"dashboard","disabled":false,"hidden":false},{"id":"e153cafbb86014ea","type":"ui_tab","name":"food","icon":"dashboard","disabled":false,"hidden":false},{"id":"960301b41003c880","type":"ui_tab","name":"test","icon":"dashboard","disabled":false,"hidden":false},{"id":"f78034d6b60b791a","type":"ui_tab","name":"Tab 1","icon":"dashboard","order":1,"disabled":false,"hidden":false}]